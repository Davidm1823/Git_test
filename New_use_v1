 Connect-ExchangeOnline

$First_name = Read-Host "What is the first name of the new user?"

$Last_name = Read-Host "What is the users last name?"

#license selection
Read-Host "What is license you would like to assign to the user Secect a number between 1 and 3?"
$LicenseSKU = Read-Host "1-Buiness basic 2-Buiness Premium 3-none"


# Lets you select what license you will be giving the account you are creating

if ($LicenseSKU -eq "1") {
    $LicenseSKU = "O365_BUSINESS_ESSENTIALS"
} elseif ($LicenseSKU -eq "2") {
    $LicenseSKU = "SPB"
} else {
    return
}


#New user display name
$Display_name = $First_name + " " + $Last_name


#New user Alias
$alias = $First_name

# New user email address
$User_EmailAddress = $First_name[0] + $Last_name + "@agiftcorp.com"




# Create the new mailbox
New-Mailbox -Alias $alias -Name $Display_name -FirstName $First_name -LastName $Last_name -DisplayName $Display_name -MicrosoftOnlineServicesID $User_EmailAddress -Password (ConvertTo-SecureString -String 'P@ssw0rd' -AsPlainText -Force) 

# Add a license to the user
Set-MsolUserLicense -UserPrincipalName $User_EmailAddress -AddLicenses $LicenseSKU





# pauses the script for 5 mintues to allow mail box to be created.
Start-Sleep -Seconds 600


# Full access permission to  monitor email This 
# This does not allow send as or on behalf of
Add-MailboxPermission -Identity $User_EmailAddress -User JMkluger@agiftcorp.com -AccessRights FullAccess -AutoMapping $false

Add-MailboxPermission -Identity $User_EmailAddress -User JLkluger@agiftcorp.com -AccessRights FullAccess -AutoMapping $false

Add-MailboxPermission -Identity $User_EmailAddress -User gakluger@agiftcorp.com -AccessRights FullAccess -AutoMapping $false


#Send on behalf of 
Add-RecipientPermission -Identity $User_EmailAddress -User JMkluger@agiftcorp.com  -AccessRights SendAs 

Add-RecipientPermission -Identity $User_EmailAddress -User JLkluger@agiftcorp.com  -AccessRights SendAs

Add-RecipientPermission -Identity $User_EmailAddress -User gakluger@agiftcorp.com  -AccessRights SendAs





# Send As
#Add-RecipientPermission -Identity $User_EmailAddress -User JMkluger@agiftcorp.com  -AccessRights SendAs

#Add-RecipientPermission -Identity $User_EmailAddress -User JLkluger@agiftcorp.com  -AccessRights SendAs

#Add-RecipientPermission -Identity $User_EmailAddress -User gakluger@agiftcorp.com  -AccessRights SendAs